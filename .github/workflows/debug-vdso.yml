name: VDSO Problem Diagnosis

on:
  workflow_dispatch:

jobs:
  diagnose:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Full VDSO Analysis
      run: |
        echo "ğŸ¯ VDSOé—®é¢˜å…¨é¢è¯Šæ–­"
        echo "========================"
        
        echo "1. GitçŠ¶æ€"
        echo "å½“å‰åˆ†æ”¯: $(git branch --show-current)"
        echo "æœ€æ–°æäº¤: $(git log --oneline -1)"
        echo ""
        
        echo "2. VDSOæ–‡ä»¶æ£€æŸ¥"
        if [ -f "arch/arm64/include/asm/vdso.h" ]; then
          echo "âœ… VDSOæ–‡ä»¶å­˜åœ¨"
          echo "æ–‡ä»¶å¤§å°: $(wc -l < arch/arm64/include/asm/vdso.h) è¡Œ"
          echo "æœ€åä¿®æ”¹: $(stat -c %y arch/arm64/include/asm/vdso.h)"
        else
          echo "âŒ VDSOæ–‡ä»¶ä¸å­˜åœ¨"
          exit 1
        fi
        echo ""
        
        echo "3. å…³é”®ç¬¦å·æ£€æŸ¥"
        echo "æœç´¢vdso_offset_sigtramp:"
        grep -n "vdso_offset_sigtramp" arch/arm64/include/asm/vdso.h || echo "æœªæ‰¾åˆ°"
        echo ""
        
        echo "4. æ–‡ä»¶å®Œæ•´å†…å®¹"
        echo "--- VDSOæ–‡ä»¶å¼€å§‹ ---"
        cat arch/arm64/include/asm/vdso.h
        echo "--- VDSOæ–‡ä»¶ç»“æŸ ---"
