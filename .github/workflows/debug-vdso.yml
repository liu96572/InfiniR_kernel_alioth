name: VDSO Problem Diagnosis

on:
  workflow_dispatch:

jobs:
  diagnose:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Full VDSO Analysis
      run: |
        echo "🎯 VDSO问题全面诊断"
        echo "========================"
        
        echo "1. Git状态"
        echo "当前分支: $(git branch --show-current)"
        echo "最新提交: $(git log --oneline -1)"
        echo ""
        
        echo "2. VDSO文件检查"
        if [ -f "arch/arm64/include/asm/vdso.h" ]; then
          echo "✅ VDSO文件存在"
          echo "文件大小: $(wc -l < arch/arm64/include/asm/vdso.h) 行"
          echo "最后修改: $(stat -c %y arch/arm64/include/asm/vdso.h)"
        else
          echo "❌ VDSO文件不存在"
          exit 1
        fi
        echo ""
        
        echo "3. 关键符号检查"
        echo "搜索vdso_offset_sigtramp:"
        grep -n "vdso_offset_sigtramp" arch/arm64/include/asm/vdso.h || echo "未找到"
        echo ""
        
        echo "4. 文件完整内容"
        echo "--- VDSO文件开始 ---"
        cat arch/arm64/include/asm/vdso.h
        echo "--- VDSO文件结束 ---"
