name: Precise Error Finder

on:
  workflow_dispatch:

jobs:
  find-error:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Find exact error location
      run: |
        echo "🎯 精确查找错误位置..."
        
        # 快速安装依赖
        sudo apt update > /dev/null 2>&1
        sudo apt install -y build-essential gcc-aarch64-linux-gnu bc flex bison libelf-dev > /dev/null 2>&1
        
        export ARCH=arm64
        export CROSS_COMPILE=aarch64-linux-gnu-
        
        # 配置
        make alioth_defconfig > /dev/null 2>&1
        echo "✅ 配置完成"
        
        # 构建并捕获第一个致命错误
        echo "🔍 查找第一个致命错误..."
        make -j1 2>&1 | grep -E -A5 -B5 "(error:|Error:|ERROR:|stop|Stop)" | head -20
